<!-- Template: QuizPro results page - summarizes performance and provides next actions -->
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta tags and title -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuizPro — Results</title>
  <!-- Stylesheet and favicon -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='assets/favicon/favicon.ico') }}">
</head>
<body>
  <!-- Nav bar with dropdown menu -->
  <div class="menu-bar-wrapper">
    <div class="menu-bar">
      <a href="{{ url_for('setup') }}" class="btn back-btn">Run Another Quiz</a>
      <button id="menuToggle" class="menu-toggle" title="Menu">☰</button>
      <div id="dropdownMenu" class="dropdown-menu">
        <label class="switch">
          Dark Mode
          <input type="checkbox" id="themeToggle">
          <span class="slider"></span>
        </label>
        <a href="{{ url_for('logout') }}" class="dropdown-item">Logout</a>
      </div>
    </div>
  </div>
  <div class="container">
    <!-- Display session title -->
    <h2>{{ title }}</h2>
    <!-- Summary Header: overall score and percentage -->
    <h3>All Done!</h3>
    <p>You answered {{ total_answered }} questions and got {{ total_answered - wrong_count }} correct ({{ 100 - percent_wrong }}%).</p>
    <!-- Detailed list of each question, user answer, and correct answer -->
    <ul>
      {% for q, a in zip(questions, answers) %}
        <li>
          <strong>{{ q.prompt }}</strong><br>
          <!-- Options list highlighting user choice and correct answer -->
          <ul class="options-list">
            {% for letter, text in q.options.items() %}
              <li{% if letter == a %} class="user-choice"{% endif %}{% if letter == q.correct_answer %} class="correct-choice"{% endif %}>
                {{ letter }}) {{ text }}
              </li>
            {% endfor %}
          </ul>
          <!-- User's selected answer -->
          <div>Your answer: <strong>{{ a }}) {{ q.options[a] if q.options[a] else '' }}</strong></div>
          <!-- Correct answer -->
          <div>Correct answer: <strong>{{ q.correct_answer }}) {{ q.options[q.correct_answer] }}</strong></div>
          <!-- Feedback message -->
          {% if a == q.correct_answer %}
            <div class="result correct">Correct!</div>
          {% else %}
            <div class="result incorrect">Incorrect</div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
    <!-- Action buttons: retry incorrect, similar topic quiz, or new quiz -->
    <div class="results-actions">
      {% if incorrect %}
        <form action="{{ url_for('retry_incorrect') }}" method="post" style="display:inline">
          <button type="submit">Retry Incorrect</button>
        </form>
        <form action="{{ url_for('adaptive_followup') }}" method="post" style="display:inline; margin-left:8px;">
          <button type="submit">Similar Topic Quiz</button>
        </form>
      {% endif %}
      <form action="{{ url_for('setup') }}" method="get" style="display:inline; margin-left:8px;">
        <button type="submit">Run Another Quiz</button>
      </form>
    </div>
    <!-- Dropdown toggle script -->
    <script>
      document.getElementById('menuToggle').addEventListener('click', () => {
        const menu = document.getElementById('dropdownMenu');
        const opening = menu.style.display !== 'block';
        if (opening) {
          const toggle = document.getElementById('themeToggle');
          const isDark = document.documentElement.classList.contains('dark');
          if (toggle) toggle.checked = isDark;
        }
        menu.style.display = opening ? 'block' : 'none';
      });
      document.addEventListener('click', e => {
        const menu = document.getElementById('dropdownMenu');
        const toggle = document.getElementById('menuToggle');
        if (!toggle.contains(e.target) && !menu.contains(e.target)) {
          menu.style.display = 'none';
        }
      });
    </script>
    <script>
      (function() {
        const toggle = document.getElementById('themeToggle');
        const root = document.documentElement;
        const current = localStorage.getItem('theme') || 'light';
        // Apply saved theme and sync toggle state
        if (current === 'dark') {
          root.classList.add('dark');
          if (toggle) toggle.checked = true;
        } else {
          if (toggle) toggle.checked = false;
        }
        if (!toggle) return;
        // Toggle theme based on checkbox change
        toggle.addEventListener('change', () => {
          if (toggle.checked) {
            root.classList.add('dark');
            localStorage.setItem('theme', 'dark');
          } else {
            root.classList.remove('dark');
            localStorage.setItem('theme', 'light');
          }
        });
      })();
    </script>
  </div>
</body>
</html>
